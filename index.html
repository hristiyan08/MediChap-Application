<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediChat Application</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<img src="images/MediChat_transparent-.png" height="400" width="400" class="logo-image" />
<h1 class="title">Портал за кандидатстване на лекари към MediChat</h1>
<form id="application-form">
    <p class="title-text">Моля, попълнете Вашите данни, за да кандидатстване за достъп към MediChat:</p>
    <input type="text" id="name" class="name" placeholder="Имена" required><br>
    <input type="text" id="uin" class="uin" placeholder="УИН" required><br>
    <input type="email" id="email" class="email" placeholder="Имейл" required><br>
    <button type="submit" class="apply-button" id="apply">Кандидатствай!</button>
</form>
<script type="module">

    import { getAuth, sendSignInLinkToEmail } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDiiAFQ8wsOQDPhNtpz-5OK6vRRaZScBwc",
        authDomain: "medichat-c9b01.firebaseapp.com",
        databaseURL: "https://medichat-c9b01-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "medichat-c9b01",
        storageBucket: "medichat-c9b01.appspot.com",
        messagingSenderId: "444288721707",
        appId: "1:444288721707:web:c20c844c3e07406ae95b6e",
        measurementId: "G-8Y04QRWSVD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();

    // Configure the email action link
    const actionCodeSettings = {
        url: 'https://medichat-application.vercel.app/email.html', // Или друг валиден URL
        handleCodeInApp: true,
    };

    document.getElementById("application-form").addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent form submission

        const email = document.getElementById("email").value; // Get the email value

        // Send sign-in link to the email
        sendSignInLinkToEmail(auth, email, actionCodeSettings)
            .then(() => {
                // Save the email locally to complete sign-in when the user returns
                window.localStorage.setItem('emailForSignIn', email);
                alert("Съобщение с линк за вход е изпратено на Вашия имейл. Моля, проверете!");
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.error("Грешка при изпращане на имейл:", errorCode, errorMessage);
                alert("Възникна грешка: " + errorMessage);
            });
    });
</script>
</body>
</html>
